{"version":3,"file":"taquito-beacon-wallet.umd.js","sources":["../src/taquito-beacon-wallet.ts"],"sourcesContent":["import {\n  DAppClient,\n  DAppClientOptions,\n  RequestPermissionInput,\n  PermissionResponseOutput,\n  PermissionScope,\n} from '@airgap/beacon-sdk';\n\nimport {\n  createOriginationOperation,\n  createSetDelegateOperation,\n  createTransferOperation,\n  WalletDelegateParams,\n  WalletOriginateParams,\n  WalletProvider,\n  WalletTransferParams,\n} from '@taquito/taquito';\n\nexport class BeaconWalletNotInitialized implements Error {\n  name = 'BeaconWalletNotInitialized';\n  message = 'You need to initialize BeaconWallet by calling beaconWallet.requestPermissions first';\n}\n\nexport class MissingRequiredScopes implements Error {\n  name = 'MissingRequiredScopes';\n  message: string;\n\n  constructor(public requiredScopes: PermissionScope[]) {\n    this.message = `Required permissions scopes were not granted: ${requiredScopes.join(',')}`;\n  }\n}\n\nexport class BeaconWallet implements WalletProvider {\n  public client: DAppClient;\n\n  private permissions?: PermissionResponseOutput;\n\n  constructor(options: DAppClientOptions) {\n    this.client = new DAppClient(options);\n  }\n\n  private getPermissionOrFail() {\n    if (!this.permissions) {\n      throw new BeaconWalletNotInitialized();\n    }\n\n    return this.permissions;\n  }\n\n  private validateRequiredScopesOrFail(\n    permission: PermissionResponseOutput,\n    requiredScopes: PermissionScope[]\n  ) {\n    const mandatoryScope = new Set(requiredScopes);\n\n    for (const scope of permission.scopes) {\n      if (mandatoryScope.has(scope)) {\n        mandatoryScope.delete(scope);\n      }\n    }\n\n    if (mandatoryScope.size > 0) {\n      throw new MissingRequiredScopes(Array.from(mandatoryScope));\n    }\n  }\n\n  async requestPermissions(request?: RequestPermissionInput) {\n    const activeAccount = await this.client.getActiveAccount();\n\n    if (activeAccount) {\n      this.permissions = activeAccount;\n      return;\n    }\n\n    const result = await this.client.requestPermissions(request);\n    this.permissions = result;\n  }\n\n  private removeFeeAndLimit<T extends { gas_limit: any; storage_limit: any; fee: any }>(op: T) {\n    const { fee, gas_limit, storage_limit, ...rest } = op;\n    return rest;\n  }\n\n  getPKH() {\n    const { address } = this.getPermissionOrFail();\n    return Promise.resolve(address);\n  }\n\n  mapTransferParamsToWalletParams(params: WalletTransferParams) {\n    return createTransferOperation(params);\n  }\n\n  mapOriginateParamsToWalletParams(params: WalletOriginateParams) {\n    return createOriginationOperation(params as any);\n  }\n\n  mapDelegateParamsToWalletParams(params: WalletDelegateParams) {\n    return createSetDelegateOperation(params as any);\n  }\n\n  async sendOperations(params: any[]) {\n    const permissions = this.getPermissionOrFail();\n    this.validateRequiredScopesOrFail(permissions, [PermissionScope.OPERATION_REQUEST]);\n\n    const network = permissions.network;\n    const { transactionHash } = await this.client.requestOperation({\n      network,\n      operationDetails: params.map(op => ({\n        ...this.removeFeeAndLimit(op),\n      })) as any,\n    });\n    return transactionHash;\n  }\n}\n"],"names":["DAppClient","createTransferOperation","createOriginationOperation","createSetDelegateOperation","PermissionScope"],"mappings":"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"}